<link
   rel="stylesheet"
   href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css" />
<style>
   .tbl-center {
      text-align: center;
   }
</style>
<div class="row mt-4">
   <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
      <div class="card">
         <div class="card-header p-3 pt-2">
            <div
               class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute">
               <i class="material-icons opacity-10">weekend</i>
            </div>
            <div class="text-end pt-1">
               <h4 class="mb-0">Số phòng</h4>
            </div>
         </div>
         <hr class="dark horizontal my-0" />
         <div class="card-footer p-3">
            <h5 class="num-room"><%= data.countRoom %> phòng hiện có</h5>
         </div>
      </div>
   </div>
   <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
      <div class="card">
         <div class="card-header p-3 pt-2">
            <div
               class="icon icon-lg icon-shape bg-gradient-primary shadow-primary text-center border-radius-xl mt-n4 position-absolute">
               <i class="material-icons opacity-10">person</i>
            </div>
            <div class="text-end pt-1">
               <h4 class="mb-0">Người dùng</h4>
            </div>
         </div>
         <hr class="dark horizontal my-0" />
         <div class="card-footer p-3">
            <h5 class="num-user"><%= data.countUser %> người dùng</h5>
         </div>
      </div>
   </div>
   <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
      <div class="card">
         <div class="card-header p-3 pt-2">
            <div
               class="icon icon-lg icon-shape bg-gradient-success shadow-success text-center border-radius-xl mt-n4 position-absolute">
               <i class="material-icons opacity-10">airline_seat_flat</i>
            </div>
            <div class="text-end pt-1">
               <h4 class="mb-0">Đặt phòng</h4>
            </div>
         </div>
         <hr class="dark horizontal my-0" />
         <div class="card-footer p-3">
            <h5 class="num-booking">
               <%= data.countBooking %> phiếu đặt phòng
            </h5>
         </div>
      </div>
   </div>
   <div class="col-xl-3 col-sm-6">
      <div class="card">
         <div class="card-header p-3 pt-2">
            <div
               class="icon icon-lg icon-shape bg-gradient-success shadow-info text-center border-radius-xl mt-n4 position-absolute">
               <i class="material-icons opacity-10">featured_play_list </i>
            </div>
            <div class="text-end pt-1">
               <h4 class="mb-0">Thanh toán</h4>
            </div>
         </div>
         <hr class="dark horizontal my-0" />
         <div class="card-footer p-3">
            <h5 class="num-payment"><%= data.countBill %> hóa đơn</h5>
         </div>
      </div>
   </div>
   <div class="col-xl-3 col-sm-6 mt-4">
      <div class="card">
         <div class="card-header p-3 pt-2">
            <div
               class="icon icon-lg icon-shape bg-gradient-info shadow-info text-center border-radius-xl mt-n4 position-absolute">
               <i class="material-icons opacity-10">featured_play_list </i>
            </div>
            <div class="text-end pt-1">
               <h4 class="mb-0">Số vé máy bay</h4>
            </div>
         </div>
         <hr class="dark horizontal my-0" />
         <div class="card-footer p-3">
            <h5 class="num-payment">
               <%= statisticalTicketAndFlight.countTicket %> vé
            </h5>
         </div>
      </div>
   </div>
   <div class="col-xl-3 col-sm-6 mt-4">
      <div class="card">
         <div class="card-header p-3 pt-2">
            <div
               class="icon icon-lg icon-shape bg-gradient-primary shadow-info text-center border-radius-xl mt-n4 position-absolute">
               <i class="material-icons opacity-10">featured_play_list </i>
            </div>
            <div class="text-end pt-1">
               <h4 class="mb-0">Số chuyến bay</h4>
            </div>
         </div>
         <hr class="dark horizontal my-0" />
         <div class="card-footer p-3">
            <h5 class="num-payment">
               <%= statisticalTicketAndFlight.countFlight %> chuyến bay
            </h5>
         </div>
      </div>
   </div>
</div>

<div class="row mt-3">
   <div class="col-md-4 col-sm-4">
      <div class="input-group input-group-outline mb-3 focused is-focused">
         <label class="form-label">Từ ngày</label>
         <input
            id="since"
            type="date"
            class="form-control" />
      </div>
   </div>
   <div class="col-md-4 col-sm-4">
      <div class="input-group input-group-outline mb-3 focused is-focused">
         <label class="form-label">Đến ngày</label>
         <input
            id="arrive"
            type="date"
            class="form-control" />
      </div>
   </div>
   <div class="col-md-3 col-sm-3">
      <button class="btn btn-getListBooking btn-primary">Lọc</button>
   </div>
</div>
<div class="row mt-3">
   <div class="row mt-3">
      <!-- thống kê đặt phòng--start -->
      <div class="col-lg-6">
         <div class="card">
            <div class="card-body">
               <h4 class="card-title">Thống kê đặt phòng</h4>
               <div class="table-responsive">
                  <table
                     style="color: #344767"
                     class="table header-border table-hover verticle-middle">
                     <thead>
                        <tr>
                           <th scope="col">Đặt phòng</th>
                           <th
                              class="tbl-center"
                              scope="col">
                              Số lượng
                           </th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td>Mới</td>
                           <td class="tbl-center bookNew"><%= roomNew %></td>
                        </tr>

                        <tr>
                           <td>Đã nhận phòng</td>
                           <td class="tbl-center bookCheck">
                              <%= roomCheckin %>
                           </td>
                        </tr>

                        <tr>
                           <td>Đã thanh toán</td>
                           <td class="tbl-center bookCheck">
                              <%= roomSuccess %>
                           </td>
                        </tr>
                        <tr>
                           <td>Đã hủy</td>
                           <td class="tbl-center bookCheck">
                              <%= roomCancel %>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
         </div>
         <div class="mt-3">
            <h4 class="revenue-week">
               Doanh thu đặt phòng: <%= new Intl.NumberFormat('vi-VN', { style:
               'currency', currency: 'VND' }).format(totalAmount) %>
            </h4>
         </div>
      </div>
      <!-- thống kê đặt phòng--end -->

      <!-- thống kê đặt vé--start -->
      <div class="col-lg-6">
         <div class="card">
            <div class="card-body">
               <h4 class="card-title">Thống kê đặt vé máy bay</h4>
               <div class="table-responsive">
                  <table
                     style="color: #344767"
                     class="table header-border table-hover verticle-middle">
                     <thead>
                        <tr>
                           <th scope="col">Đặt vé</th>
                           <th
                              class="tbl-center"
                              scope="col">
                              Số lượng
                           </th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr>
                           <td>Mới</td>
                           <td class="tbl-center bookNew">
                              <%= flightWaiting %>
                           </td>
                        </tr>

                        <tr>
                           <td>Đã duyệt</td>
                           <td class="tbl-center bookCheck">
                              <%= flightAccept %>
                           </td>
                        </tr>

                        <tr>
                           <td>Thành công</td>
                           <td class="tbl-center bookCheck">
                              <%= flightDone %>
                           </td>
                        </tr>
                        <tr>
                           <td>Đã hủy</td>
                           <td class="tbl-center bookCheck">
                              <%= flightCancel %>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
         </div>
         <div class="mt-3">
            <h4 class="revenue-week">
               Doanh thu đặt vé: <%= new Intl.NumberFormat('vi-VN', { style:
               'currency', currency: 'VND' }).format(totalAmountFlight) %>
            </h4>
         </div>
      </div>
      <!-- thống kê đặt vé--end -->
   </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>

<script>
   $('.btn-getListBooking').click(() => {
      let checkin = $('#since').val(),
         checkout = $('#arrive').val();
      window.location.href = `/admin?startDate=${checkin}&endDate=${checkout}`;
   });

   const params = new Proxy(new URLSearchParams(window.location.search), {
      get: (searchParams, prop) => searchParams.get(prop),
   });
   let dayStart = params.startDate;
   let dayEnd = params.endDate;
   let today;
   let tomorrow;

   if (dayStart && dayEnd) {
      today = new Date(dayStart);
      tomorrow = new Date(dayEnd);
   } else {
      today = new Date();
      tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
   }
   today = today.toISOString().split('T')[0];
   tomorrow = tomorrow.toISOString().split('T')[0];

   $('#arrive').val(tomorrow);
   $('#since').val(today);
</script>
